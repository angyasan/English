<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <title>ÂçòË™ûÂ∏≥</title>
  <style>
    #quizOverlay {
      position: fixed;
      top: 0; left: 0;
      width: 100%; height: 100%;
      background: rgba(0,0,0,0.6);
      display: none;
      justify-content: center;
      align-items: center;
      z-index: 999;
    }
    #quizContainer {
      background: white;
      padding: 20px;
      border-radius: 8px;
      width: 90%;
      max-width: 400px;
      text-align: center;
      box-shadow: 0 4px 10px rgba(0,0,0,0.3);
    }
    .hidden {
      display: none !important;
    }
    .quiz-jp {
      font-size: 1.5em;
      font-weight: bold;
      margin-bottom: 10px;
    }
    .quiz-en {
      font-size: 1.2em;
      color: #444;
      margin-bottom: 15px;
    }
    .quiz-kana {
      font-size: 1em;
      color: #666;
      margin-top: 5px;
    }
    body {
      font-family: -apple-system, sans-serif;
      padding: 20px;
      max-width: 480px;
      margin: auto;
    }
    h2 {
      margin-bottom: 15px;
    }
    .tabs {
      display: flex;
      margin-bottom: 10px;
    }
    .tab-btn {
      flex: 1;
      padding: 10px 0;
      cursor: pointer;
      border: 1px solid #ccc;
      background: #f9f9f9;
      text-align: center;
      font-weight: bold;
      user-select: none;
      transition: background-color 0.3s;
    }
    .tab-btn.active {
      background-color: #007bff;
      color: white;
      border-color: #007bff;
    }
    .control-buttons {
      display: flex;
      gap: 8px;
      margin-bottom: 15px;
      user-select: none;
    }
    .control-btn {
      cursor: pointer;
      background-color: #eee;
      border: 1px solid #ccc;
      padding: 6px 12px;
      border-radius: 4px;
      font-size: 14px;
      transition: background-color 0.2s;
    }
    .control-btn:hover {
      background-color: #ddd;
    }
    .entry {
      margin-bottom: 18px;
      border-bottom: 1px solid #eee;
      padding-bottom: 10px;
      cursor: pointer;
      user-select: none;
    }
    .jp {
      font-size: 18px;
      color: #333;
      white-space: pre-line;
    }
    .details {
      display: none;
      margin-top: 6px;
      color: #555;
      font-size: 16px;
      display: flex;
      gap: 12px;
      align-items: center;
      user-select: text;
    }
    .en {
      font-weight: bold;
      font-size: 17px;
    }
    .kana {
      color: #666;
      font-size: 15px;
    }
    .play-btn {
      margin-left: auto;
      cursor: pointer;
      border: none;
      background: transparent;
      font-size: 20px;
      user-select: none;
      color: #007bff;
      transition: color 0.2s;
    }
    .play-btn:hover {
      color: #0056b3;
    }
    #quizAnswerRow {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      gap: 4px;
      margin-bottom: 4px;
    }
    #kanaText {
      margin-top: 8px;
      text-align: center;
    }
    /* ‰æãÊñá„Éú„Çø„É≥ */
    .example-btn {
      cursor: pointer;
      border: 1px solid #007bff;
      background: #e7f1ff;
      padding: 3px 8px;
      border-radius: 4px;
      font-size: 14px;
      color: #007bff;
      user-select: none;
      transition: background-color 0.2s;
    }
    .example-btn:hover {
      background-color: #c2dbff;
    }
  </style>
</head>
<body>

  <h2>üìò ÂçòË™ûÂ∏≥</h2>

  <div class="tabs">
    <div class="tab-btn active" data-type="verbs">ÂãïË©û</div>
    <div class="tab-btn" data-type="nouns">ÂêçË©û</div>
    <div class="tab-btn" data-type="adverbs">ÂâØË©û</div>
    <div class="tab-btn" data-type="adjectives">ÂΩ¢ÂÆπË©û</div>
  </div>

  <div id="controls" class="control-buttons">
    <button class="control-btn" id="shuffleBtn">„Ç∑„É£„ÉÉ„Éï„É´</button>
    <button class="control-btn" id="resetBtn">ÂÖÉ„Å´Êàª„Åô</button>
    <button id="startQuizBtn" class="control-btn">J‚ÜíE„ÇØ„Ç§„Ç∫</button>
  </div>

  <div id="content"></div>

  <!-- „ÇØ„Ç§„Ç∫„É¢„Éº„ÉÄ„É´ -->
  <div id="quizOverlay">
    <div id="quizContainer">
      <div id="quizProgress" style="margin-bottom: 10px; font-size: 14px; color: #555;"></div>
      <div id="jpText" class="quiz-jp"></div>
      <div id="quizAnswerRow" class="hidden">
        <div style="display: flex; flex-direction: column; align-items: center; justify-content: center; line-height: 1.2;">
          <div id="enText" class="quiz-en hidden" style="text-align: center;"></div>
          <div id="kanaText" class="quiz-kana hidden" style="text-align: center; margin-top: 2px;"></div>
        </div>
      </div>
      <button id="showAnswerBtn">Á≠î„Åà„ÇíË¶ã„Çã</button>
      <button id="nextBtn" style="display:none;">Ê¨°„Å∏</button>
      <button id="quitQuizBtn">„ÇÑ„ÇÅ„Çã</button>
    </div>
  </div>

  <!-- ‰æãÊñá„É¢„Éº„ÉÄ„É´ -->
  <div id="exampleModal" class="hidden" style="
    position: fixed; top:0; left:0; width:100%; height:100%;
    background: rgba(0,0,0,0.6); display:flex; justify-content:center; align-items:center;
    z-index:1000;">
    <div style="background:white; width:90%; max-width:600px; height:70%; position:relative; border-radius:8px; overflow:hidden;">
      <button id="closeExampleModal" style="
        position:absolute; top:8px; right:10px; z-index:1001;
        background:white; border:1px solid #ccc; border-radius:4px;
        padding:4px 8px; cursor:pointer;">‚úñ</button>
      <iframe id="exampleFrame" src="" style="width:100%; height:100%; border:none;"></iframe>
    </div>
  </div>

<script>
document.addEventListener("DOMContentLoaded", () => {
  // ÂÖÉ„Éá„Éº„Çø
  const originalData = {
    verbs: [
      {jp:"„Äú„Åß„ÅÇ„Çã/„ÅÑ„Çã", en:"be", reading:"„Éì„Éº"},
      {jp:"„Äú„Å´„Å™„Çã", en:"become", reading:"„Éì„Ç´„É†"},
      {jp:"Âõû„Åô", en:"turn", reading:"„Çø„Éº„É≥"},
      {jp:"ÊåÅ„Å£„Å¶„Åè„Çã", en:"bring", reading:"„Éñ„É™„É≥„Ç∞"},
      {jp:"ÊåÅ„Å£„Å¶„ÅÑ„Åè", en:"take", reading:"„ÉÜ„Ç§„ÇØ"},
      {jp:"ÈÅã„Å∂", en:"carry", reading:"„Ç≠„É£„É™„Éº"},
      {jp:"ÁõÆ„ÅåË¶ö„ÇÅ„Çã", en:"wake up", reading:"„Ç¶„Çß„Ç§„ÇØ „Ç¢„ÉÉ„Éó"},
      {jp:"Ëµ∑„Åç‰∏ä„Åå„Çã", en:"get up", reading:"„Ç≤„ÉÉ„Éà „Ç¢„ÉÉ„Éó"},
      {jp:"Â¢ó„Åà„Çã", en:"increase", reading:"„Ç§„É≥„ÇØ„É™„Éº„Çπ"},
    ],
    nouns: [],
    adverbs: [],
    adjectives: []
  };

  const currentList = {
    verbs: [...originalData.verbs],
    nouns: [...originalData.nouns],
    adverbs: [...originalData.adverbs],
    adjectives: [...originalData.adjectives],
  };

  const contentDiv = document.getElementById("content");
  const tabButtons = document.querySelectorAll(".tab-btn");
  const shuffleBtn = document.getElementById("shuffleBtn");
  const resetBtn = document.getElementById("resetBtn");
  const startQuizBtn = document.getElementById("startQuizBtn");
  const quizOverlay = document.getElementById("quizOverlay");
  const quizProgress = document.getElementById("quizProgress");
  const jpText = document.getElementById("jpText");
  const enText = document.getElementById("enText");
  const kanaText = document.getElementById("kanaText");
  const quizAnswerRow = document.getElementById("quizAnswerRow");
  const showAnswerBtn = document.getElementById("showAnswerBtn");
  const nextBtn = document.getElementById("nextBtn");
  const quitQuizBtn = document.getElementById("quitQuizBtn");
  const exampleModal = document.getElementById("exampleModal");
  const exampleFrame = document.getElementById("exampleFrame");
  const closeExampleModalBtn = document.getElementById("closeExampleModal");

  let currentType = "verbs";
  let quizList = [];
  let currentQuizIndex = 0;

  // Èü≥Â£∞ÂÜçÁîüÈñ¢Êï∞
  function playSound(word) {
    const url = `https://ssl.gstatic.com/dictionary/static/sounds/20200429/${word.toLowerCase()}--_us_1.mp3`;
    const audio = new Audio(url);
    audio.play().catch(() => {});
  }

  // ÈÖçÂàó„Ç∑„É£„ÉÉ„Éï„É´
  function shuffleArray(arr) {
    const a = arr.slice();
    for(let i = a.length -1; i > 0; i--) {
      const j = Math.floor(Math.random() * (i+1));
      [a[i], a[j]] = [a[j], a[i]];
    }
    return a;
  }

  // ÂçòË™û„É™„Çπ„ÉàÊèèÁîª
  function renderList(type) {
    contentDiv.innerHTML = "";
    currentList[type].forEach(item => {
      const entry = document.createElement("div");
      entry.className = "entry";

      const jpDiv = document.createElement("div");
      jpDiv.className = "jp";
      jpDiv.textContent = item.jp;

      const detailsDiv = document.createElement("div");
      detailsDiv.className = "details";

      const enSpan = document.createElement("span");
      enSpan.className = "en";
      enSpan.textContent = item.en;

      const kanaSpan = document.createElement("span");
      kanaSpan.className = "kana";
      if(item.reading) kanaSpan.textContent = item.reading;

      const playBtn = document.createElement("button");
      playBtn.className = "play-btn";
      playBtn.textContent = "‚ñ∂Ô∏è";
      playBtn.title = `Áô∫Èü≥ÂÜçÁîü: ${item.en}`;
      playBtn.onclick = (e) => {
        e.stopPropagation();
        playSound(item.en);
      };

      const exampleBtn = document.createElement("button");
      exampleBtn.className = "example-btn";
      exampleBtn.textContent = "‰æãÊñá";
      exampleBtn.onclick = (e) => {
        e.stopPropagation();
        showExampleModal(item.en);
      };

      detailsDiv.appendChild(enSpan);
      if(item.reading) detailsDiv.appendChild(kanaSpan);
      detailsDiv.appendChild(playBtn);
      detailsDiv.appendChild(exampleBtn);

      entry.appendChild(jpDiv);
      entry.appendChild(detailsDiv);

      detailsDiv.style.display = "none";

      jpDiv.addEventListener("click", () => {
        detailsDiv.style.display = (detailsDiv.style.display === "flex") ? "none" : "flex";
      });

      contentDiv.appendChild(entry);
    });
  }

  // „ÇØ„Ç§„Ç∫Âá∫È°å
  function showQuizQuestion() {
    const item = quizList[currentQuizIndex];
    jpText.textContent = item.jp;
    enText.textContent = item.en;
    kanaText.textContent = item.reading || "";

    enText.classList.add("hidden");
    kanaText.classList.add("hidden");
    quizAnswerRow.classList.add("hidden");

    quizProgress.textContent = `${currentQuizIndex + 1} / ${quizList.length} Âïè`;
    showAnswerBtn.style.display = "inline-block";
    nextBtn.style.display = "none";
  }

  // „ÇØ„Ç§„Ç∫Êìç‰Ωú„Ç§„Éô„É≥„Éà
  tabButtons.forEach(btn => {
    btn.addEventListener("click", () => {
      tabButtons.forEach(b => b.classList.remove("active"));
      btn.classList.add("active");
      currentType = btn.getAttribute("data-type");
      renderList(currentType);
    });
  });

  shuffleBtn.addEventListener("click", () => {
    currentList[currentType] = shuffleArray(originalData[currentType]);
    renderList(currentType);
  });

  resetBtn.addEventListener("click", () => {
    currentList[currentType] = [...originalData[currentType]];
    renderList(currentType);
  });

  startQuizBtn.addEventListener("click", () => {
    quizList = shuffleArray([...currentList[currentType]]);
    currentQuizIndex = 0;
    if(quizList.length === 0) {
      alert("ÂïèÈ°å„Åå„ÅÇ„Çä„Åæ„Åõ„Çì");
      return;
    }
    showQuizQuestion();
    quizOverlay.style.display = "flex";
  });

  showAnswerBtn.addEventListener("click", () => {
    enText.classList.remove("hidden");
    kanaText.classList.remove("hidden");
    quizAnswerRow.classList.remove("hidden");
    showAnswerBtn.style.display = "none";
    nextBtn.style.display = "inline-block";

    enText.onclick = () => {
      playSound(enText.textContent);
    };
  });

  nextBtn.addEventListener("click", () => {
    currentQuizIndex++;
    if(currentQuizIndex >= quizList.length) {
      alert("ÂÖ®ÂïèÁµÇ‰∫ÜÔºÅ");
      quizOverlay.style.display = "none";
    } else {
      showQuizQuestion();
    }
  });

  quitQuizBtn.addEventListener("click", () => {
    quizOverlay.style.display = "none";
  });

  closeExampleModalBtn.addEventListener("click", () => {
    exampleModal.classList.add("hidden");
    exampleFrame.src = "";
  });

  // ‰æãÊñá„É¢„Éº„ÉÄ„É´Ë°®Á§∫
  function showExampleModal(word) {
    const url = `https://ejje.weblio.jp/sentence/content/${encodeURIComponent(word)}`;
    exampleFrame.src = url;
    exampleModal.classList.remove("hidden");
  }

  // ÂàùÊúüË°®Á§∫
  renderList(currentType);
});
</script>

</body>
</html>

